# Linux Root-Level Changes

This document summarizes the system-level changes made to a Linux host when installing a Replicated Embedded Cluster, particularly in relation to directories, files, and runtime configurations affected under `/`.

## Key Directories Created

During installation, the Embedded Cluster creates several directories for container runtimes, network configuration, logging, and Kubernetes internals. These directories may be used for binary placement, socket communication, runtime data, or logging.

| Path                                         | Description                                                   |
|----------------------------------------------|---------------------------------------------------------------|
| `/etc/cni`                                   | CNI (Container Network Interface) configuration               |
| `/etc/k0s`                                   | Configuration for the k0s Kubernetes distribution             |
| `/opt/cni`                                   | Optional location for CNI plugin binaries                     |
| `/opt/containerd`                            | Data and binaries for containerd runtime                      |
| `/run/calico`                                | Calico's runtime data and state                               |
| `/run/containerd`                            | Runtime socket and process management for containerd          |
| `/run/k0s`                                   | Runtime files and PID info for k0s                            |
| `/sys/fs/cgroup/kubepods`                    | cgroup hierarchy for Kubernetes pods                          |
| `/sys/fs/cgroup/system.slice/containerd.service` | cgroup slice for the containerd system service               |
| `/sys/fs/cgroup/system.slice/k0scontroller.service` | cgroup slice for the k0scontroller service                  |
| `/usr/libexec/k0s`                           | Executables used by k0s, potentially for internal service components |
| `/usr/local/bin/k0s`                         | The k0s binary, typically symlinked or copied here            |
| `/var/lib/calico`                            | Persistent data for the Calico network plugin                 |
| `/var/lib/cni`                               | CNI state and cache                                           |
| `/var/lib/containers`                        | OCI container storage (may contain container images and layers) |
| `/var/lib/kubelet`                           | State for the kubelet, pod manifests, volumes, etc.           |
| `/var/log/calico`                            | Logs generated by Calico agents                               |
| `/var/log/containers`                        | Logs for individual containers, typically symlinked from journald |
| `/var/log/embedded-cluster`                  | Logs specific to Embedded Cluster installation and runtime    |
| `/var/log/pods`                              | Logs organized by pod name/namespace                          |

## Runtime & Kernel Modifications

- **cgroups** are used extensively to isolate resources:
  - `kubepods` cgroup under `/sys/fs/cgroup`
  - Systemd slices for services like `containerd` and `k0scontroller`
- These modifications may impact systems with strict lockdowns or non-standard cgroup hierarchies.

## Binaries and Services

- The `k0s` binary is typically placed at `/usr/local/bin/k0s`.
- Services for `k0scontroller`, `containerd`, and possibly `calico` will be active post-install.
- Some services may install unit files in `/etc/systemd/system/`.

## Considerations

- Persistent volumes, logs, and container state are stored under `/var/lib` and `/var/log`.
- Networking components are configured under `/etc/cni` and `/opt/cni`.
- May conflict with existing Kubernetes or container runtimes already installed on the host.
- **SELinux**, **AppArmor**, and other security frameworks might require adjustments.
